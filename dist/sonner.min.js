import{SuccessIcon,WarningIcon,InfoIcon,ErrorIcon,CloseIcon}from"./icons.js";import{styles}from"./styles.js";const VISIBLE_TOASTS_AMOUNT=3;const VIEWPORT_OFFSET="32px";const TOAST_LIFETIME=4e3;const TOAST_WIDTH=356;const GAP=14;const SWIPE_THRESHOLD=20;const TIME_BEFORE_UNMOUNT=200;class Sonner{constructor(options={}){const{closeButton,richColors,position,duration}=options;this.closeButton=closeButton||false;this.richColors=richColors||false;this.position=position||"bottom-right";this.duration=duration||TOAST_LIFETIME;this.ol=null;this.init()}init(){if(this.reinitializeToaster()){return}this.renderToaster({closeButton:this.closeButton,richColors:this.richColors,position:this.position});this.ol=document.getElementById("sonner-toaster-list");this.registerMouseOver(this.ol);this.registerKeyboardShortcuts(this.ol);this.buildStyles()}success(msg,options={}){const toast=this.show(msg,{type:"success",...options});return toast}error(msg,options={}){const toast=this.show(msg,{type:"error",...options});return toast}info(msg,options={}){const toast=this.show(msg,{type:"info",...options});return toast}warning(msg,options={}){const toast=this.show(msg,{type:"warning",...options});return toast}show(msg,{description,type,duration,action,classes}={}){const list=document.getElementById("sonner-toaster-list");const{toast,id}=this.renderToast(list,msg,{description:description,type:type,action:action});setTimeout(()=>{const el=list.children[0];const height=el.getBoundingClientRect().height;el.setAttribute("data-mounted","true");el.setAttribute("data-initial-height",height);el.style.setProperty("--initial-height",`${height}px`);list.style.setProperty("--front-toast-height",`${height}px`);this.registerSwipe(id);this.refreshProperties();this.registerRemoveTimeout(el,duration);action&&el.addEventListener("click",action);action&&el.setAttribute("data-action","true");classes&&el.classList.add(classes)},16);return id}remove(id){const el=document.querySelector(`[data-id="${id}"]`);if(!el)return;el.setAttribute("data-removed","true");this.refreshProperties();const previousTid=el.getAttribute("data-unmount-tid");if(previousTid)window.clearTimeout(previousTid);const tid=setTimeout(()=>{el.parentElement?.removeChild(el)},TIME_BEFORE_UNMOUNT);el.setAttribute("data-unmount-tid",tid)}getAsset(type){switch(type){case"success":return SuccessIcon;case"info":return InfoIcon;case"warning":return WarningIcon;case"error":return ErrorIcon;default:return null}}genid(){return Date.now().toString(36)+Math.random().toString(36).substring(2,12).padStart(12,0)}renderToast(list,msg,{type,description,action}){const toast=document.createElement("div");list.prepend(toast);const id=this.genid();const count=list.children.length;const asset=this.getAsset(type);toast.outerHTML=`<li
      aria-live="polite"
      aria-atomic="true"
      role="${action?"button":"status"}"
      data-action="${action?"true":"false"}"
      tabindex="0"
      data-id="${id}"
      data-type="${type}"
      data-sonner-toast=""
      data-mounted="false"
      data-styled="true"
      data-promise="false"
      data-removed="false"
      data-visible="true"
      data-y-position="${list.getAttribute("data-y-position")}"
      data-x-position="${list.getAttribute("data-x-position")}"
      data-index="${0}"
      data-front="true"
      data-swiping="false"
      data-dismissible="true"
      data-swipe-out="false"
      data-expanded="false"
      style="--index: 0; --toasts-before: ${0}; --z-index: ${count}; --offset: 0px; --initial-height: 0px;"
    >
        ${list.getAttribute("data-close-button")==="true"?`<button
            aria-label="Close"
            data-disabled=""
            class="absolute top-0.5 right-0.5 border border-neutral-800 text-neutral-800 bg-neutral-100 rounded-sm"
            onclick="window.sonnerInstance.remove('${id}')"
          >
            ${CloseIcon}
          </button>
        `:""}
        ${asset?`
      <div data-icon="" class="">
        ${asset}
      </div>
  `:""}
      <div
            data-content=""
            class="">
        <div data-title="" class="">
          ${msg}
        </div>
        ${description?`<div data-description="" class="">${description}</div>`:""}
      </div>
  </li>
     `;return{toast:toast,id:id}}registerRemoveTimeout(el,duration=this.duration){const tid=setTimeout(()=>{this.remove(el.getAttribute("data-id"))},duration);el.setAttribute("data-remove-tid",tid)}reinitializeToaster(){this.ol=document.getElementById("sonner-toaster-list");if(!this.ol)return;for(let i=0;i<this.ol.children.length;i++){const el=this.ol.children[i];const id=el.getAttribute("data-id");this.registerSwipe(id);this.refreshProperties();this.registerRemoveTimeout(el)}return this.ol}renderToaster({closeButton,richColors,position}){const el=document.createElement("div");document.body.appendChild(el);position=position.split("-");el.outerHTML=`
  <section aria-label="Notifications alt+T" tabindex="-1">
    <ol
      dir="ltr"
      tabindex="-1"
      data-sonner-toaster="true"
      data-theme="light"
      data-close-button="${closeButton}"
      data-rich-colors="${richColors}"
      data-y-position="${position[0]}"
      data-x-position="${position[1]}"
      style="--front-toast-height: 0px; --offset: ${VIEWPORT_OFFSET}; --width: ${TOAST_WIDTH}px; --gap: ${GAP}px;"
      id="sonner-toaster-list"
    ></ol>
  </section>
  `}registerMouseOver(ol){ol.addEventListener("mouseenter",()=>{for(let i=0;i<ol.children.length;i++){const el=ol.children[i];if(el.getAttribute("data-expanded")==="true")continue;el.setAttribute("data-expanded","true");this.clearRemoveTimeout(el)}});ol.addEventListener("mouseleave",()=>{for(let i=0;i<ol.children.length;i++){const el=ol.children[i];if(el.getAttribute("data-expanded")==="false")continue;el.setAttribute("data-expanded","false");this.registerRemoveTimeout(el)}})}registerKeyboardShortcuts(ol){window.addEventListener("keydown",e=>{if(e.altKey&&e.code==="KeyT"){if(!ol||ol.children.length===0)return;const expanded=ol.children[0].getAttribute("data-expanded");const newExpanded=expanded==="true"?"false":"true";for(let i=0;i<ol.children.length;i++){ol.children[i].setAttribute("data-expanded",newExpanded)}}})}clearRemoveTimeout(el){const tid=el.getAttribute("data-remove-tid");if(tid)window.clearTimeout(tid)}refreshProperties(){const list=document.getElementById("sonner-toaster-list");let heightsBefore=0;let removed=0;for(let i=0;i<list.children.length;i++){const el=list.children[i];if(el.getAttribute("data-removed")==="true"){removed++;continue}const idx=i-removed;el.setAttribute("data-index",idx);el.setAttribute("data-front",idx===0?"true":"false");el.setAttribute("data-visible",idx<VISIBLE_TOASTS_AMOUNT?"true":"false");el.style.setProperty("--index",idx);el.style.setProperty("--toasts-before",idx);el.style.setProperty("--offset",`${GAP*idx+heightsBefore}px`);el.style.setProperty("--z-index",list.children.length-i);heightsBefore+=Number(el.getAttribute("data-initial-height"))}}registerSwipe(id){const el=document.querySelector(`[data-id="${id}"]`);if(!el)return;let dragStartTime=null;let pointerStart=null;const y=el.getAttribute("data-y-position");el.addEventListener("pointerdown",event=>{dragStartTime=new Date;event.target.setPointerCapture(event.pointerId);if(event.target.tagName==="BUTTON")return;el.setAttribute("data-swiping","true");pointerStart={x:event.clientX,y:event.clientY}});el.addEventListener("pointerup",event=>{pointerStart=null;const swipeAmount=Number(el.style.getPropertyValue("--swipe-amount").replace("px","")||0);const timeTaken=(new Date).getTime()-dragStartTime.getTime();const velocity=Math.abs(swipeAmount)/timeTaken;if(Math.abs(swipeAmount)>=SWIPE_THRESHOLD||velocity>.11){el.setAttribute("data-swipe-out","true");this.remove(id);return}el.style.setProperty("--swipe-amount","0px");el.setAttribute("data-swiping","false")});el.addEventListener("pointermove",event=>{if(!pointerStart)return;const yPosition=event.clientY-pointerStart.y;const xPosition=event.clientX-pointerStart.x;const clamp=y==="top"?Math.min:Math.max;const clampedY=clamp(0,yPosition);const swipeStartThreshold=event.pointerType==="touch"?10:2;const isAllowedToSwipe=Math.abs(clampedY)>swipeStartThreshold;if(isAllowedToSwipe){el.style.setProperty("--swipe-amount",`${yPosition}px`)}else if(Math.abs(xPosition)>swipeStartThreshold){pointerStart=null}})}buildStyles(){const style=document.createElement("style");style.innerHTML=styles;document.head.appendChild(style)}}export default Sonner;